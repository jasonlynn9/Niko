<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic-Tac-Guess - Compact Mobile Layout Final</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            touch-action: manipulation;
        }
        .cell.selected {
            background-color: #60a5fa; /* blue-400 */
        }
        .keyboard-btn.disabled {
            opacity: 0.4;
            cursor: not-allowed;
            background-color: #6b7280; /* gray-500 */
        }
        #rules-btn {
            cursor: pointer;
        }

        /* --- GLOBAL & MOBILE LAYOUT ADJUSTMENTS (Default styles) --- */
        #game-container {
            padding-top: 1rem;
            padding-bottom: 0.5rem;
        }

        /* Hangman Word Height Fix (Mobile & Desktop) */
        #word-container {
            padding-top: 1.25rem; 
            padding-bottom: 1.25rem;
            min-height: 5rem; 
            height: auto !important; 
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
        }

        /* Mobile Compaction */
        #header-area .mb-4 { margin-bottom: 0.5rem !important; }
        #status-container { margin-bottom: 0.5rem !important; } 

        /* 1. Vertical Strikes Container Setup (Mobile Only) */
        #strikes-wrapper {
            /* Centers the entire board + strikes block horizontally */
            display: flex;
            align-items: flex-start; 
            justify-content: center; 
            gap: 0.75rem; 
            width: 100%;
            margin: 0.5rem auto;
            max-width: 400px; 
        }
        
        /* FIX: Ensure strikes column is aligned with the top of the dots (flex-start) */
        #strikes-column {
            display: flex; 
            flex-direction: column;
            align-items: center; 
            justify-content: flex-start; /* Ensure it starts from the top */
            height: 100%; 
            padding: 0;
            order: 1;
            /* Adjust margin to shift the column slightly left */
            margin-left: -1rem; 
        }
        
        #strikes-container {
            flex-direction: column;
            height: 100%;
            padding: 0;
            gap: 0; /* Remove gap here; vertical alignment will be handled by JS space-between */
            justify-content: space-between; /* Space out the dots evenly along the column height */
            align-items: center;
            margin-top: 0; 
        }
        
        .strike-circle {
            width: 1rem; 
            height: 1rem;
            border-radius: 50%;
            border: 1px solid #dc2626; 
            /* Ensure no margin/padding interference */
            flex-shrink: 0; 
        }
        .strike-circle.filled {
            background-color: #dc2626; 
        }

        /* Hide Strikes Label for the vertical column display on mobile */
        #strikes-label-mobile {
            display: none;
        }
        
        /* 2. Board Size Adjustment (80% of container) */
        #board {
            width: 80vw;
            max-width: 300px;
            margin: 0;
            padding: 0;
            aspect-ratio: 1 / 1;
            order: 2;
        }
        .cell {
            font-size: 2.5rem;
        }
        
        /* 3. Tighter Spacing & Sizing (Mobile) */
        #player-x-score, #player-o-score { font-size: 0.875rem; }
        #round-info { font-size: 0.875rem; }
        #status-message { font-size: 1rem; }
        #keyboard { margin-top: 0.5rem; }
        .keyboard-btn { padding: 0.5rem; }
        .mt-4, .my-4 { margin-top: 0.5rem !important; margin-bottom: 0.5rem !important; }


        /* --- DESKTOP LAYOUT ADJUSTMENTS (md: and up) --- */
        @media (min-width: 768px) {
            #game-container {
                max-width: 1200px;
                padding: 2rem;
            }
            #main-content-wrapper {
                display: flex;
                flex-direction: row;
                align-items: flex-start;
                justify-content: center;
                gap: 4rem;
                margin-top: 2rem;
            }
            #left-column, #center-column, #keyboard-column {
                flex: 1;
                max-width: 350px;
            }
            
            /* Revert Strikes Display for Desktop */
            #strikes-wrapper {
                display: block;
                width: 100%;
                margin: 0;
                padding: 0;
            }
            #strikes-column {
                display: none !important; /* Hide mobile vertical column on desktop */
            }
            #strikes-container {
                flex-direction: row; 
                justify-content: center;
                margin-top: 0.5rem;
                height: 0.5rem;
            }
            .strike-circle {
                width: 1.5rem; 
                height: 0.5rem;
                border-radius: 0.25rem;
                border: none;
                background-color: #6b7280; 
            }
            
            /* Restore desktop-specific spacing */
            #status-container { margin-bottom: 1.5rem; }
            #word-container { 
                margin-top: 1.5rem;
                margin-bottom: 1.5rem;
                padding-top: 1rem;
                padding-bottom: 1rem;
            }
            
            /* Desktop board/cell sizing */
            #board {
                width: 100%;
                max-width: 350px;
                margin-top: 1rem;
                order: 2;
            }
            .cell { font-size: 3rem; }

            #rules-btn {
                position: absolute;
                top: 1rem;
                right: 1rem;
            }
            
            #round-info { font-size: 0.875rem; }
            
            /* Ensure the desktop strikes label is visible */
            #strikes-label-desktop {
                display: block !important;
            }
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen p-4">

    <div id="game-container" class="w-full max-w-lg mx-auto text-center relative md:max-w-7xl">
        
        <div id="header-area" class="w-full text-center mb-2 md:mb-0 md:static">
            <button id="rules-btn" class="absolute -top-2 -right-2 text-gray-500 hover:text-white transition-colors z-10 md:top-6 md:right-6">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-9 w-9" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </button>
            <h1 class="text-4xl md:text-6xl font-bold mb-1 text-cyan-400">Tic-Tac-Guess</h1>
            
            <p class="text-gray-400 mb-2">
                Win Tic-Tac-Toe by guessing letters in the secret word.
                <a href="https://notebooklm.google.com/notebook/e553e503-e4d8-430a-bf04-bef5ccee8200" target="_blank" class="text-blue-400 hover:text-blue-300 font-semibold ml-2">
                    NotebookLM Deep Dive
                </a>
            </p>
        </div>

        <div id="main-content-wrapper" class="w-full flex flex-col items-center md:flex-row md:items-start md:justify-center">
        
            <div id="left-column" class="w-full md:w-auto mt-2">
                <div class="flex justify-between items-center w-full mb-2 text-lg">
                    <div id="player-x-score" class="bg-gray-800 px-3 py-1 rounded-lg transition-colors duration-300">Player X: 0</div>
                    <div id="round-info" class="font-bold">Round 1 / 3</div>
                    <div id="player-o-score" class="bg-gray-800 px-3 py-1 rounded-lg transition-colors duration-300">Player O: 0</div>
                </div>

                <div id="status-container" class="h-12 flex items-center justify-center mb-1 md:mb-6">
                    <p id="status-message" class="text-xl font-semibold bg-gray-800 px-4 py-2 rounded-lg shadow-md transition-all duration-300">Player X's Turn: Select a square</p>
                </div>

                <div id="word-container" class="text-3xl md:text-4xl tracking-widest my-1 h-10 flex items-center justify-center font-mono bg-gray-800 p-3 rounded-lg">
                    </div>
                
                <div class="my-2 md:hidden">
                    <p id="strikes-label-mobile" class="text-sm text-gray-400 hidden">Strikes</p>
                </div>

                <div class="my-2 hidden md:block">
                    <p id="strikes-label-desktop" class="text-sm text-gray-400">Strikes</p>
                    <div id="strikes-container-desktop" class="flex justify-center items-center space-x-2 h-6 md:flex-row md:h-6 md:space-x-2">
                        </div>
                </div>
            </div>

            <div id="center-column" class="w-full md:w-auto mt-2">
                
                <div id="strikes-wrapper" class="md:block">
                    
                    <div id="strikes-column" class="flex md:hidden">
                        <div id="strikes-container" class="flex justify-center items-center space-x-2 h-6">
                            </div>
                    </div>

                    <div id="board" class="grid grid-cols-3 gap-2 aspect-square">
                        </div>

                </div>
                
                <div class="mt-4 space-x-4">
                    <button id="next-round-btn" class="hidden bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-lg transition-transform transform hover:scale-105">
                        Next Round
                    </button>
                    <button id="restart-game-btn" class="bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg shadow-lg transition-transform transform hover:scale-105">
                        Restart Game
                    </button>
                </div>
            </div>
            
            <div id="keyboard-column" class="w-full md:w-auto mt-4">
                <div id="keyboard" class="grid grid-cols-7 sm:grid-cols-9 gap-1 text-sm md:text-base md:grid-cols-7 md:gap-2">
                    </div>
            </div>

        </div> </div> <div id="rules-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50">
        <div class="bg-gray-800 rounded-lg p-6 max-w-lg w-full shadow-xl relative text-left border border-gray-700">
            <button id="close-modal-btn" class="absolute top-3 right-3 text-gray-500 hover:text-white">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <h2 class="2xl font-bold mb-4 text-cyan-400">How to Play</h2>
            <div class="space-y-4 text-gray-300">
                <p><strong class="font-semibold text-white">Objective:</strong> Be the player with the most points after 3 rounds.</p>
                <div>
                    <h3 class="font-semibold text-white text-lg mb-2">Gameplay:</h3>
                    <ul class="list-disc list-inside space-y-1.5 pl-2">
                        <li>On your turn, first click an empty square on the Tic-Tac-Toe board.</li>
                        <li>Then, guess a letter for the secret word.</li>
                        <li>A <strong class="text-green-400">correct</strong> guess places your mark (X or O) on the selected square.</li>
                        <li>An <strong class="text-red-400">incorrect</strong> guess gives you a strike, and you lose your turn to place a mark.</li>
                        <li>The round ends when the secret word is completed or you run out of strikes (8 total).</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-semibold text-white text-lg mb-2">Scoring:</h3>
                    <ul class="list-disc list-inside space-y-1.5 pl-2">
                        <li>Win Tic-Tac-Toe (3 in a row): <strong class="text-amber-400">+3 points</strong>.</li>
                        <li>Complete the word <strong class="font-semibold">before</strong> Tic-Tac-Toe is won: <strong class="text-amber-400">+5 points</strong>.</li>
                        <li>Complete the word <strong class="font-semibold">after</strong> Tic-Tac-Toe has been won: <strong class="text-amber-400">+2 points</strong>.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>


    <script>
        // --- JAVASCRIPT LOGIC ---
        window.addEventListener('error', function(e) {
            console.error('An unhandled error occurred:', e.message);
        });

        const boardElement = document.getElementById('board');
        const wordContainer = document.getElementById('word-container');
        const statusMessage = document.getElementById('status-message');
        const keyboardElement = document.getElementById('keyboard');
        const restartGameBtn = document.getElementById('restart-game-btn');
        const nextRoundBtn = document.getElementById('next-round-btn');
        const strikesContainer = document.getElementById('strikes-container');
        const strikesContainerDesktop = document.getElementById('strikes-container-desktop'); 
        
        const playerXScoreElement = document.getElementById('player-x-score');
        const playerOScoreElement = document.getElementById('player-o-score');
        const roundInfoElement = document.getElementById('round-info');
        const rulesBtn = document.getElementById('rules-btn');
        const rulesModal = document.getElementById('rules-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        
        const wordList = [
            "REACT", "ANGULAR", "JAVASCRIPT", "PYTHON", "TAILWIND", "COMPONENT", "FRAMEWORK", "LIBRARY", "DEVELOPER", "INTERFACE",
            "ALGORITHM", "DATABASE", "FRONTEND", "BACKEND", "SERVER", "CLOUD", "NETWORK", "SECURITY", "ENCRYPT", "DEPLOYMENT",
            "FUNCTION", "VARIABLE", "ITERATION", "PROTOCOL", "API", "GALAXY", "PLANET", "NEBULA", "AURORA", "COMET",
            "KEYBOARD", "MONITOR", "MOUSE", "PRINTER", "STORAGE", "MOTHERBOARD", "MICROCHIP", "SOFTWARE", "HARDWARE", "INTERNET",
            "COMPUTER", "PROGRAM", "CODING", "ENGINEER", "MODULAR", "SYNTAX", "BOOLEAN", "ARRAY", "OBJECT", "ASYNC"
        ];
        
        const MAX_STRIKES = 8;
        const MAX_ROUNDS = 3;
        let state = {};

        function restartGame() {
            try {
                state = {
                    scores: { X: 0, O: 0 },
                    currentRound: 0,
                };
                startNewRound();
            } catch (error) {
                console.error("Error in restartGame:", error);
                if (statusMessage) statusMessage.textContent = "Error: Cannot start game. Check console.";
            }
        }
        
        function startNewRound() {
            state.currentRound++;
            state.currentPlayer = 'X';
            state.board = Array(9).fill(null);
            state.currentWord = wordList[Math.floor(Math.random() * wordList.length)];
            state.guessedLetters = [];
            state.incorrectGuesses = 0;
            state.selectedSquare = null;
            state.gameOver = false;
            state.ticTacToeWinner = null;
            nextRoundBtn.classList.add('hidden');
            restartGameBtn.textContent = 'Restart Game';
            render();
        }

        function render() {
            renderBoard();
            renderWord();
            renderKeyboard();
            renderStrikes();
            renderScoresAndRound();
            updateStatus();
        }
        
        function renderScoresAndRound() {
            playerXScoreElement.textContent = `Player X: ${state.scores.X}`;
            playerOScoreElement.textContent = `Player O: ${state.scores.O}`;
            if (state.currentRound <= MAX_ROUNDS) {
                roundInfoElement.textContent = `Round ${state.currentRound} / ${MAX_ROUNDS}`;
            }
        }

        function renderBoard() {
            boardElement.innerHTML = '';
            state.board.forEach((cell, index) => {
                const cellElement = document.createElement('div');
                cellElement.classList.add('cell', 'bg-gray-800', 'rounded-lg', 'flex', 'items-center', 'justify-center', 'font-bold', 'cursor-pointer', 'transition-all', 'duration-200', 'hover:bg-gray-700', 'aspect-square');
                cellElement.dataset.index = index;

                if (cell === 'X') {
                    cellElement.textContent = 'X';
                    cellElement.classList.add('text-teal-400');
                } else if (cell === 'O') {
                    cellElement.textContent = 'O';
                    cellElement.classList.add('text-amber-400');
                }
                
                if (state.selectedSquare === index) {
                    cellElement.classList.add('selected');
                }

                boardElement.appendChild(cellElement);
            });
        }

        function renderWord() {
            const displayWord = state.currentWord
                .split('')
                .map(letter => (state.guessedLetters.includes(letter) ? letter : '_'))
                .join(' ');
            wordContainer.textContent = displayWord;
        }

        function renderKeyboard() {
            keyboardElement.innerHTML = '';
            const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            alphabet.split('').forEach(letter => {
                const btn = document.createElement('button');
                btn.textContent = letter;
                btn.classList.add('keyboard-btn', 'bg-gray-700', 'rounded-md', 'p-2', 'font-semibold', 'transition-all', 'hover:bg-gray-600', 'transform', 'hover:scale-110');
                btn.dataset.letter = letter;

                if (state.guessedLetters.includes(letter) || state.gameOver) {
                     btn.classList.add('disabled');
                }
                
                keyboardElement.appendChild(btn);
            });
        }
        
        function renderStrikes() {
            const isMobileLayout = window.innerWidth < 768;
            
            // Determine which container to use
            const currentStrikesContainer = isMobileLayout ? strikesContainer : strikesContainerDesktop;
            if (!currentStrikesContainer) return;

            currentStrikesContainer.innerHTML = '';

            // Dynamic sizing of the strikes column based on board size (Mobile only)
            if (isMobileLayout) {
                const boardWidth = boardElement.offsetWidth;
                const strikesColumn = document.getElementById('strikes-column');
                if (strikesColumn) {
                    // Set height dynamically based on the actual board element size
                    strikesColumn.style.height = `${boardWidth}px`; 
                    // Set justify-content on the strikes column wrapper (strikes-container)
                    strikesContainer.style.justifyContent = 'space-between';
                }
            } else {
                 // Reset spacing for desktop container
                strikesContainer.style.justifyContent = 'center';
            }

            for (let i = 0; i < MAX_STRIKES; i++) {
                const strikeElement = document.createElement('div');
                
                if (isMobileLayout) {
                    // Mobile: Vertical, Hollow circles that fill
                    strikeElement.classList.add('strike-circle');
                } else {
                    // Desktop: Horizontal, Small filled bars
                    strikeElement.classList.add('w-6', 'h-2', 'rounded-full');
                }

                if (i < state.incorrectGuesses) {
                    strikeElement.classList.add('bg-red-500', 'filled');
                } else if (!isMobileLayout) {
                    strikeElement.classList.add('bg-gray-600');
                }
                
                currentStrikesContainer.appendChild(strikeElement);
            }
        }

        function updateStatus() {
            if (state.gameOver) {
                return;
            }

            if (state.ticTacToeWinner) {
                 statusMessage.textContent = `Player ${state.currentPlayer} is finishing the word...`;
            } else if (state.selectedSquare === null) {
                statusMessage.textContent = `Player ${state.currentPlayer}'s Turn: Select a square`;
            } else {
                statusMessage.textContent = `Player ${state.currentPlayer}'s Turn: Guess a letter`;
            }
        }

        function handleSquareClick(index) {
            if (state.gameOver || state.board[index] !== null || state.ticTacToeWinner) {
                return;
            }
            state.selectedSquare = index;
            renderBoard();
            updateStatus();
        }

        function handleLetterGuess(letter) {
            if (state.gameOver || state.guessedLetters.includes(letter)) return;
            if (state.selectedSquare === null && !state.ticTacToeWinner) return;

            state.guessedLetters.push(letter);
            const isCorrect = state.currentWord.includes(letter);

            let turnMessage = "";

            if (isCorrect) {
                turnMessage = "Correct!";

                if (!state.ticTacToeWinner) {
                    state.board[state.selectedSquare] = state.currentPlayer;
                }

                const wordCompleted = state.currentWord.split('').every(l => state.guessedLetters.includes(l));
                const tttWinner = checkWinner();
                
                if (wordCompleted) {
                    const points = state.ticTacToeWinner ? 2 : 5;
                    state.scores[state.currentPlayer] += points;
                    turnMessage = `Word complete! +${points} for Player ${state.currentPlayer}`;
                    endRound();
                } else if (tttWinner && !state.ticTacToeWinner) {
                    state.ticTacToeWinner = tttWinner;
                    state.scores[tttWinner] += 3;
                    state.currentPlayer = tttWinner;
                    turnMessage = `Player ${tttWinner} won the board (+3 pts)! Keep guessing.`;
                }

            } else { // Incorrect guess
                turnMessage = "Wrong!";
                state.incorrectGuesses++;

                if (state.incorrectGuesses >= MAX_STRIKES) {
                    turnMessage = `Out of strikes! The word was: ${state.currentWord}`;
                    endRound();
                } else if (!state.ticTacToeWinner) {
                    state.currentPlayer = state.currentPlayer === 'X' ? 'O' : 'X';
                }
            }

            if (!state.ticTacToeWinner) {
                state.selectedSquare = null;
                if (!state.board.includes(null) && !checkWinner()) {
                    state.ticTacToeWinner = 'DRAW';
                    turnMessage = 'Board is a draw! Finish the word.';
                }
            }
            
            statusMessage.textContent = turnMessage;
            
            setTimeout(render, 800);
        }

        function endRound() {
            state.gameOver = true;

            if (state.currentRound >= MAX_ROUNDS) {
                let finalMessage;
                if (state.scores.X > state.scores.O) {
                    finalMessage = `Player X wins the game ${state.scores.X} to ${state.scores.O}!`;
                } else if (state.scores.O > state.scores.X) {
                    finalMessage = `Player O wins the game ${state.scores.O} to ${state.scores.X}!`;
                } else {
                    finalMessage = `The game is a tie! ${state.scores.X} to ${state.scores.O}.`;
                }
                statusMessage.textContent = finalMessage;
                restartGameBtn.textContent = 'Play Again?';
                nextRoundBtn.classList.add('hidden');
            } else {
                nextRoundBtn.classList.remove('hidden');
            }
        }

        function checkWinner() {
            const winningCombos = [
                [0, 1, 2], [3, 4, 5], [6, 7, 8],
                [0, 3, 6], [1, 4, 7], [2, 5, 8],
                [0, 4, 8], [2, 4, 6]
            ];

            for (const combo of winningCombos) {
                const [a, b, c] = combo;
                if (state.board[a] && state.board[a] === state.board[b] && state.board[a] === state.board[c]) {
                    return state.board[a];
                }
            }
            return null;
        }

        function openRulesModal() {
            rulesModal.classList.remove('hidden');
        }

        function closeRulesModal() {
            rulesModal.classList.add('hidden');
        }

        // --- Event Listeners ---
        boardElement.addEventListener('click', (e) => {
            const index = e.target.closest('.cell')?.dataset.index;
            if (index !== undefined) {
                handleSquareClick(parseInt(index));
            }
        });

        keyboardElement.addEventListener('click', (e) => {
            const letter = e.target.closest('.keyboard-btn')?.dataset.letter;
            if (letter) {
                handleLetterGuess(letter);
            }
        });

        restartGameBtn.addEventListener('click', restartGame);
        nextRoundBtn.addEventListener('click', startNewRound);
        
        rulesBtn.addEventListener('click', openRulesModal);
        closeModalBtn.addEventListener('click', closeRulesModal);
        rulesModal.addEventListener('click', (e) => {
            if (e.target === rulesModal) {
                closeRulesModal();
            }
        });
        
        // Rerender strikes when window is resized to switch layouts and adjust dynamic height
        window.addEventListener('resize', () => {
             renderStrikes();
             render();
        });
        
        document.addEventListener('DOMContentLoaded', () => {
            restartGame(); 
            // A slight delay to ensure the board is fully rendered before calculating strikes height
            setTimeout(renderStrikes, 100); 
        });
    </script>
</body>
</html>
